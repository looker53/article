## 目录

（该文章要求我们多读几个框架源码，像 webpy, bottle, flask）

- web框架的功能设计（一个微框架需要包含哪些核心功能）
    - 核心是处理请求、返回响应
    - 服务和应用分离（WSGI）
    - 方便自定义路由
    - 常见的中间件支持
- 如何编程处理网络请求（socket）
- HTTP 消息规范
- 如何接收 HTTP 请求
    - HTTP 请求规范
    - 获取 URL 和 客户端地址（如何 ban ip）
    - 获取请求方法
    - 获取请求头
    - 获取请求体
- 如何返回 HTTP 响应
    - HTTP 响应规范
    - 普通文本响应
    - 错误处理
    - HTML 文件响应（TODO:模板支持）
    - JSON 数据响应
    - 文件响应
- 服务和应用拆分
    - WSGI 协议
- 多线程支持
- 路由
- 中间件
    - 登录
    - 数据库


##  web框架的功能设计

我是一名python开发者，平时的主要是编写自动化程序，偶尔我会把一些自动化程序集成到网页当中，提供用可视化的界面，让自动化程序变得更加容易使用。在实际的工作过程当中，我接触了非常多优秀的 Web开发框架，比如非常主流的 Django 框架，它提供的功能非常的丰富；还有很多人入门学习的 Flask框架，他的设计与众不同，而且提供了非常丰富的插件系统；还有近年来非常流行的 FastAPI 框架，它提供了传统框架没有的序列化功能、依赖注入功能及后台任务功能。


这些框架的核心用法实际上大同小异，只要掌握了其中的一个框架，去学习另外的框架，会更加简单。 但是在现实生活当中总是会有很多人争论：到底哪一个框架更先进？到底那个框架容易使用？ 每次听到这样的争吵，我总是会思考一个问题：一个web开发框架究竟应该具备哪些核心的功能？而哪些功能可以通过比较方便的形式进行扩展？

当第一次接入接触web开发的时候，哪些知识应该重点去学习，而哪些可以慢慢摸索呢？在出现一些比较隐秘的问题需要解决时，应该采取什么方式去进行调试呢？这些问题都可以通过研究框架结构、深入学习源码而解决，但是随着这些现成框架的发展，他们的底层api已经隐藏的非常深，要弄清它们的原理并不容易。

这让萌生出自己开发一个玩具框架的设想，通过设计这一个玩具框架，我会明白一个Web开发框架应该具备什么样的核心功能，而这些核心功能究竟是通过一种怎样的机制完成的。 之后再采用这个设计蓝图和实现方式去理解目前主流框架的用法，应该会变得更加简单。


这个玩具框架的初步设想，是实现一个web框架应该具备的核心功能，之后再去考虑扩展功能，比如说加入数据库的支持，加入序列化和反序列化，加入后台任务的执行，加入依赖注入的功能，加入插件系统的研发。

那么一个web框架，首先应该具备一些什么样的核心功能？

